\subsection{\textit{nETL}}
\label{appendix:netl}

\subsubsection{Main class}
\label{appendix:netl-main}
\begin{minted}{javascript}
module.exports = function() {
    const _extractions = {};
    const _transformations = {};
    const _loads = {};        
    const _taskManager = new TaskManager(_extractions, _transformations, _loads);
    function _loadExtractionModule(extractionOperation){};
    function _loadTransformationModule(transformOperation){};
    function _loadLoadModule(loadOperation){};
    return {
        taskManager: _taskManager,
        loadExtractionModule: _loadExtractionModule,
        loadTransformationModule: _loadTransformationModule,
        loadLoadModule: _loadLoadModule
    };
};
\end{minted}

\subsubsection{TaskManager}
\label{appendix:netl-taskmanager}
\begin{minted}{javascript}
function TaskManager(extractions, transformations, loads) {
    this.tasks = {};
    this.extractions = extractions;
    this.transformations = transformations;
    this.loads = loads;
};
TaskManager.prototype.newTask = function(task) { /* ... */ };
\end{minted}

\subsubsection{Extraction}
\label{appendix:netl-extraction}
\begin{minted}{javascript}
/**
 * Generates lines from a flatfile
 * @yield {string} returns a single line from a flatfile
 */
function* _readLines() {
    while (pointer < filesize) {
        yield lineBuffer;
    };
};

/**
 * Generates batches of lines
 * @yield {Object[]} An array of lines
 */
function* getBatch () {
    let data = [];
    for (0..batchSize) {
        data.push(lineExtraction.getNext());
    };
    yield data;
};

// Generate lines
var lineReader = _readLines();

// Generate batches of lines
var batch = getBatch.next();
\end{minted}

\subsubsection{The engine}
\label{appendix:netl-engine}
\begin{minted}{javascript}
(function doEtlTask(self) {
    var payload = [];

    // Extract
    batch = batchExtraction.next();
    if (batch.done) return;

    // Apply transformations
    transformations.forEach(function(t) {
        batch = t.transform(batch);
    });
    payload = batch;

    // Load
    load.batch(payload)
        .then(function(msg) {
            doEtlTask(self);
        });
})();
\end{minted}

\subsubsection{}
\label{appendix:netl-loading}
\begin{minted}{javascript}
// Load the module into memory
memoryObject[userModule.name] = userModule.exe;
// Invoke the module's closure
var loadedModule = memoryObject[userModule.Name].call(userModule);
// Genrate batch from extraction module
var batch = loadedModule.getNext()
// Do transformations on batch
batch = loadedModule.transform(batch);
// Load transformed batch
load.batch(batch).then(function(msg) {}).catch(function(msg) {});
// An example userModule (an extraction module)
userModule = (function() {
    function exe(configurationObj) {
        function getNext() { /* ... */};
        return {
            getNext: getNext
        };
    };
    return {
        name: "MODULE_NAME",
        exe: exe
    };
})();
\end{minted}