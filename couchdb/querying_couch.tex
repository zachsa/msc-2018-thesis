\bibliography{../bibliography/msc_citations}
\subsection{Querying CouchDB}

CouchDB uses the concept of "Design" documents that are, like any other CouchDB document, JSON strings. But JSON documents with \textit{\_id} values of "\_design/someName>" are treated as "special"; on these documents users can define code that is executed on the CouchDB server appliation. This API comprises 6 types of functions in total. These are:

\begin{enumerate}
    \item View Functions
    \item Show Functions
    \item List Functions
    \item Update Functions
    \item Filter Functions
    \item Validate Document Update Functions
\end{enumerate}

When dealing with large amounts of data it is worth noting how the CouchDB server treats design documents; \cite{Sharma2014} found through experimentation that updating design documents will not cause view indices to be recalculated unless a view is changed, but that updating one view will cause all views to be re-calculated.

For the purpose of this project only \textit{view functions} (The CouchDB MapReduce API), and \textit{list functions} will be discussed. List functions fall under the category of \textit{CouchApps} and, as mentioned previously, are likely to be excluded from future releases. These functions iterate a view output to an HTTP(S) client, allowing a final phase of transformation - i.e. a data format switch from JSON documents to CSV format. Since \textit{list functions} form part of the HTTP API, these functions effectively allow for "insta-APIs" available to the world - a useful feature and will be discussed later.

\textit{View functions} comprise \textit{Map} and \textit{Reduce} functions. These functions have the form:

\begin{figure}[h]
    \centering
    \begin{minted}{javascript} 

        /**
         * Map function
         * @param  {Object} doc Each document in the database is passed in turn to the function
         * @return {null} Nothing is returned - key:value pairs are emitted (multiple pairs can be emitted per document)
         */
        function(doc) {
            emit(someKey, someValue);
        };

        /**
         * Reduce function
         * @param  {Object[]} [keys] A list of [key, docId] pairs - key as from the map function, and key from the original doc
         * @param  {Object[]} values Output from the map function, or from the reduce function
         * @param  {Boolean} [rereduce] Indicates whether values are output from the map (rereduce = false) or reduce (rereduce = true) function
         * @return {[type]}
         */
        function(keys, values, rereduce) {
            return // ...someValue
        };
    \end{minted}
    \caption[test1]{test2}
    \label{couchmapreduce}
\end{figure}

\textit{List} functions take the name of a \textit{MapReduce} view as an argument and iterate through the results, passing those results to a user over HTTP(S). As with all of CouchDB interactions, list functions are invoked via HTTP.