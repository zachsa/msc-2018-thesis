\section{MapReduce Contract}
\label{couchdb-mapreduce-contracts}
\begin{minted}{javascript}
/**
 * Map function
 * @param  {Object} doc Each document in the database is passed in turn to the function
 * @return {null} Nothing is returned - key:value pairs are emitted (multiple pairs can be emitted per document)
 */
function(doc) {
    emit(someKey, someValue);
};

/**
 * Reduce function (javascript implementation of the _sum function shown)
 * @param  {Object[]} [keys] A list of [key, docId] pairs - key as from the map function, and key from the original doc
 * @param  {Object[]} values Output from the map function, or from the reduce function
 * @param  {Boolean} [rereduce] Indicates whether values are output from the map (rereduce = false) or reduce (rereduce = true) function
 * @return {[type]}
 */
function(keys, values, rereduce) {
    if (rereduce) {
        return values.reduce(function(a,b) {
            return a + b;
        }, 0);
    } else {
        return values.length;
    };
};
\end{minted}

\section{Sample Design Document}
\label{couchdb-design-doc-sample}
\begin{minted}{json}
{
    "_id": "_design/sample",
    "_rev": "xxxxx",
    "language": "javascript",
    "views": {
        "view1": {
            "map": "function(doc) { ... }",
            "reduce": "function(keys, values, rereduce) { ... }"
        },
        "view2": {
            "map": "function(doc) { ... }",
            "reduce": "_stats"            
        }
    },
    "shows": {
        "show1": "function(doc, req) { ... }",
        "show2": "function(doc, req) { ... }"
    },
    "lists": {
        "listFunc1": "function(head, req) { ... };",
        "listFunc2": "function(head, req) { ... };"
    },
    "updates": {
        "update1": "function(doc, req) { ... }",
        "update2": "function(doc, req) { ... }"
    },
    "filters": {
        "filter1": "function(doc, req) { ... }",
        "filter2": "function(doc, req) { ... }"
    },
    "validate_doc_update": "function(newDoc, oldDoc, userCtx, secObj) { ... }"
}
\end{minted}

\section{Map Functions}
\subsection{Result 1}
\label{result-1-map}
\begin{minted}{javascript}
\end{minted}
\label{result-1-list}
\begin{minted}{javascript}
function(head, req) {
    provides('csv', function() {
        var headers = "Year,StudentAnonID,Course,Course %,Gr12 Eng %,Gr12 Sci %,Gr12 Mth %,Gr12 Mth Lit %,Gr12 Mth Adv %,NBT AL %,NBT QL %,NBT Mth %,Aggregation Count";
        send(headers);
        while (row = getRow()) {
            var key = row.key;
            var value = row.value;
            var yr = key[0];
            var id = key[1];
            var course = key[2];
            var courseGrade = value[0].max;
            var engGrade = value[1].max;
            var sciGrade = value[2].max;
            var mthGrade = value[3].max;
            var mthLitGrade = value[4].max;
            var mthAdvGrade = value[5].max;
            var nbtAl = value[6].max;
            var nbtQl = value[7].max;
            var nbtMth = value[8].max;
            var aggrCount = value[8].count;
            var line = "\n" + yr +
                "," + id +
                "," + course +
                "," + courseGrade +
                "," + engGrade +
                "," + sciGrade +
                "," + mthGrade +
                "," + mthLitGrade +
                "," + mthAdvGrade +
                "," + nbtAl +
                "," + nbtQl +
                "," + nbtMth +
                "," + aggrCount;
            send(line);
        };
    });
};
\end{minted}

\subsection{Result 2}
\label{result-2-map}
\begin{minted}{json}
\end{minted}
\label{result-2-list}
\begin{minted}{json}
\end{minted}

\subsection{Result 3}
\label{result-3-map}
\begin{minted}{json}
\end{minted}
\label{result-3-list}
\begin{minted}{json}
\end{minted}

\subsection{Result 4}
\label{result-4-map}
\begin{minted}{json}
\end{minted}
\label{result-4-list}
\begin{minted}{json}
\end{minted}
