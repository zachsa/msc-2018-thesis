\subsection{CouchDB}

\subsubsection{\textit{MapReduce} functions}
\label{couchdb-mapreduce-contracts}
\begin{minted}{javascript}
/**
 * Map function
 * @param  {Object} doc Each document in the database is passed in turn to the function
 * @return {null} Nothing is returned - key:value pairs are emitted (multiple pairs can be emitted per document)
 */
function(doc) {
    emit(someKey, someValue);
};

/**
 * Reduce function (javascript implementation of the _sum function shown)
 * @param  {Object[]} [keys] A list of [key, docId] pairs - key as from the map function, and key from the original doc
 * @param  {Object[]} values Output from the map function, or from the reduce function
 * @param  {Boolean} [rereduce] Indicates whether values are output from the map (rereduce = false) or reduce (rereduce = true) function
 * @return {[type]}
 */
function(keys, values, rereduce) {
    if (rereduce) {
        return values.reduce(function(a,b) {
            return a + b;
        }, 0);
    } else {
        return values.length;
    };
};
\end{minted}

\subsubsection{Sample Design Document}
\label{couchdb-design-doc-sample}
\begin{minted}{json}
{
    "_id": "_design/sample",
    "_rev": "xxxxx",
    "language": "javascript",
    "views": {
        "view1": {
            "map": "function(doc) { ... }",
            "reduce": "function(keys, values, rereduce) { ... }"
        },
        "view2": {
            "map": "function(doc) { ... }",
            "reduce": "_stats"            
        }
    },
    "shows": {
        "show1": "function(doc, req) { ... }",
        "show2": "function(doc, req) { ... }"
    },
    "lists": {
        "listFunc1": "function(head, req) { ... };",
        "listFunc2": "function(head, req) { ... };"
    },
    "updates": {
        "update1": "function(doc, req) { ... }",
        "update2": "function(doc, req) { ... }"
    },
    "filters": {
        "filter1": "function(doc, req) { ... }",
        "filter2": "function(doc, req) { ... }"
    },
    "validate_doc_update": "function(newDoc, oldDoc, userCtx, secObj) { ... }"
}

\end{minted}

\subsubsection{Design Doc}
\label{msc-design-doc}
Included are all the MapReduce views used in this project in the design document below, although separate design documents were used for each view during analysis. In general, design documents should only include a single view each (unlike the example below, where all the MapReduce queries are included in a single design document), since changing any one view would force all the views in a design document to be recalculated from scratch regardless if other views in the same design document had been updated. This creates a needless performance overhead. Storing JavaScript code in JSON documents requires that newline markers are escaped, along with double quotes, as has been done in the example below.

In this example, corresponding views and list functions for retrieving in CSV form have been given the same name.

\begin{minted}{json}

\end{minted}